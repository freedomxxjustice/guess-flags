#!/bin/bash
# entrypoint.sh

set -e  # ?????????? ?????? ??? ????? ??????

echo "Applying Aerich migrations..."
# ???? ???? ??? ?? ????????????????, ?? ??????? init-db ???? ???
# aerich init -t config_reader.TORTOISE_ORM --location ./db/migrations  # ?????? ?????? ???? ??? ????????

# ????????? ????????
aerich upgrade

echo "Starting Gunicorn..."
exec gunicorn -k uvicorn.workers.UvicornWorker main:app \
    --workers 4 \
    --bind 0.0.0.0:8000 \
    --timeout 120 \
    --keep-alive 30 \
    --log-level info \
    --access-logfile -
